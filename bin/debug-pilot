#!/usr/bin/env php
<?php

declare(strict_types=1);

/**
 * PHP Debug Pilot â€” CLI Entry Point
 *
 * Bootstraps the application, registers all drivers and integrators
 * via the DriverManager, and runs the Symfony Console application.
 */

require __DIR__ . '/../vendor/autoload.php';

use App\Commands\InstallCommand;
use App\Commands\SetupCommand;
use App\DriverManager;
use App\Drivers\PcovDriver;
use App\Drivers\XdebugDriver;
use App\Integrators\PhpStormIntegrator;
use App\Integrators\SublimeIntegrator;
use App\Integrators\VsCodeIntegrator;
use App\Support\EnvironmentDetector;
use App\Support\ExtensionInstaller;
use App\Support\InstallationAdvisor;
use Symfony\Component\Console\Application;

// ---------------------------------------------------------------
//  Bootstrap
// ---------------------------------------------------------------

$env = new EnvironmentDetector();
$advisor = new InstallationAdvisor($env);
$installer = new ExtensionInstaller($env, $advisor);

// ---------------------------------------------------------------
//  Register drivers & integrators
// ---------------------------------------------------------------

$manager = new DriverManager();

$manager
    ->registerDebugger(new XdebugDriver($env))
    ->registerDebugger(new PcovDriver($env));

$manager
    ->registerIntegrator(new VsCodeIntegrator())
    ->registerIntegrator(new PhpStormIntegrator())
    ->registerIntegrator(new SublimeIntegrator());

// ---------------------------------------------------------------
//  Run
// ---------------------------------------------------------------

$app = new Application('PHP Debug Pilot', '1.0.0');

$app->add(new SetupCommand($manager, $env, $advisor, $installer));
$app->add(new InstallCommand($installer, $advisor, $env));
$app->setDefaultCommand('setup', true);

$app->run();
